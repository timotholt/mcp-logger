<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>MCP Logger Demo</title>
    <style>
      body { font-family: sans-serif; background: #101620; color: #f5f5f5; margin: 0; padding: 24px; }
      h1 { font-size: 1.5rem; margin-bottom: 0.2rem; }
      p { margin-top: 0; }
      button { background: #3b82f6; border: none; color: #fff; padding: 8px 14px; font-size: 0.95rem; cursor: pointer; border-radius: 4px; }
      button:disabled { opacity: 0.6; cursor: default; }
      pre { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 6px; max-height: 300px; overflow-y: auto; font-size: 0.85rem; }
    </style>
  </head>
  <body>
    <h1>MCP Logger Browser Demo</h1>
    <p>This page sends an info log every 3 seconds using the shared MCP browser client.</p>
    <button id="toggle">Stop demo</button>
    <pre id="output">Preparing demo...</pre>
    <script src="/client/index.js"></script>
    <script type="text/javascript">
      (function () {
        var output = document.getElementById('output');
        var toggle = document.getElementById('toggle');
        var newline = '\n';
        var intervalMs = 3000;
        var counter = 0;
        var timer = null;

        function render(message) {
          output.textContent = message + newline + output.textContent;
        }

        function randomSixDigits() {
          return ('000000' + Math.floor(Math.random() * 1000000)).slice(-6);
        }

        var logFn = (window.createMcpLogger && window.createMcpLogger({ clientId: 'demo-browser', sessionId: 'demo-session' })) || window.mcpLog;

        if (typeof logFn !== 'function') {
          render('Failed to load MCP browser client.');
          toggle.disabled = true;
          return;
        }

        function timestamp() {
          return new Date().toLocaleString();
        }

        function sendLog() {
          counter += 1;
          var message = 'Random message ' + randomSixDigits() + ' sent at ' + timestamp();
          logFn(message).then(
            function () {
              render('#' + counter + ' sent: ' + message);
            },
            function (err) {
              render('#' + counter + ' failed: ' + (err && err.message ? err.message : 'unknown error'));
            }
          );
        }

        function start() {
          if (timer) return;
          render('Demo started at ' + timestamp());
          sendLog();
          timer = window.setInterval(sendLog, intervalMs);
          toggle.textContent = 'Stop demo';
        }

        function stop() {
          if (!timer) return;
          window.clearInterval(timer);
          timer = null;
          render('Demo paused at ' + timestamp());
          toggle.textContent = 'Start demo';
        }

        toggle.addEventListener('click', function () {
          if (timer) {
            stop();
          } else {
            start();
          }
        });

        start();
      })();
    </script>
  </body>
</html>
